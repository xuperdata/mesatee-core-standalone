language: rust
install: true
sudo: false

rust:
  - nightly-2020-04-07

matrix:
  include:
    - os: linux
      dist: bionic

script:
  #- diff -u <(echo -n) <(rustfmt -d $(find . -type f -name '*.rs' -not -path "./vendor/*"))
  - export SGX_SDK=/tmp
  - mkdir build && cd build
  - cmake -DSGX_SIM_MODE=ON -DTEST_MODE=ON .. && make
  - make sgx-test

after_success:
  - bash <(curl -s https://codecov.io/bash)  -y .github/codecov.yml

cache:
  directories:
    - .cache
